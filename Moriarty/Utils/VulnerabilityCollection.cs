using System;
using System.Collections.Generic;
using System.Linq;
using Moriarty.Msrc;

namespace Moriarty
{
    public class VulnerabilityCollection
    {
        private readonly List<Vulnerability> _vulnerabilities;

        public VulnerabilityCollection()
        {
            _vulnerabilities = Populate();
        }

        public void SetAsVulnerable(string id)
        {
            var vulnerability = _vulnerabilities.FirstOrDefault(e => e.Identification == id);
            if (vulnerability != null)
            {
                vulnerability.SetAsVulnerable();
            }
        }

        public void ShowResults()
        {
            var vulnerableItems = _vulnerabilities.Where(i => i.Vulnerable).ToList();
            foreach (var vuln in vulnerableItems)
            {
                Console.WriteLine($" [+] {vuln.Identification} : VULNERABLE");
                foreach (var exploit in vuln.KnownExploits)
                {
                    Console.WriteLine($"  [>] {exploit}");
                }
                Console.WriteLine();
            }

            int totalVulnerabilities = _vulnerabilities.Count;
            int foundVulnerabilities = vulnerableItems.Count;

            Console.WriteLine($" [*] Vulnerabilities found: {foundVulnerabilities}/{totalVulnerabilities}");
            Console.WriteLine($" [+] Scan Complete!\r\n");
        }
        public List<Vulnerability> GetAllVulnerabilities()
        {
            return _vulnerabilities;
        }

        private List<Vulnerability> Populate()
        {
            return new List<Vulnerability>()
            {
                CVE_2019_0836.GetVulnerability(),
                CVE_2019_0841.GetVulnerability(),
                CVE_2019_1064.GetVulnerability(),
                CVE_2019_1130.GetVulnerability(),
                CVE_2019_1253.GetVulnerability(),
                CVE_2019_1315.GetVulnerability(),
                CVE_2019_1385.GetVulnerability(),
                CVE_2019_1388.GetVulnerability(),
                CVE_2019_1405.GetVulnerability(),
                CVE_2020_0668.GetVulnerability(),
                CVE_2020_0683.GetVulnerability(),
                CVE_2020_1013.GetVulnerability(),
                MS10_015.GetVulnerability(),
                MS10_092.GetVulnerability(),
                MS13_053.GetVulnerability(),
                MS13_081.GetVulnerability(),
                MS14_058.GetVulnerability(),
                MS15_051.GetVulnerability(),
                MS15_078.GetVulnerability(),
                MS16_016.GetVulnerability(),
                MS16_032.GetVulnerability(),
                MS16_034.GetVulnerability(),
                MS16_135.GetVulnerability(),
                CVE_2017_7199.GetVulnerability(),
                CVE_2020_0796.GetVulnerability(),
                CVE_2023_36664.GetVulnerability(),
                CVE_2021_1675.GetVulnerability()
            };
        }
    }
}
